<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>情侣飞行棋 (Couple Flying Chess)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* 3D Dice Styles */
        .scene {
            width: 100px;
            height: 100px;
            perspective: 600px;
        }
        .cube {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1s;
        }
        .cube__face {
            position: absolute;
            width: 100px;
            height: 100px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            font-weight: bold;
            color: #475569;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }
        .cube__face--1 { transform: rotateY(  0deg) translateZ(50px); }
        .cube__face--2 { transform: rotateY( 90deg) translateZ(50px); }
        .cube__face--3 { transform: rotateY(180deg) translateZ(50px); }
        .cube__face--4 { transform: rotateY(-90deg) translateZ(50px); }
        .cube__face--5 { transform: rotateX( 90deg) translateZ(50px); }
        .cube__face--6 { transform: rotateX(-90deg) translateZ(50px); }

        .show-1 { transform: translateZ(-50px) rotateY(   0deg); }
        .show-2 { transform: translateZ(-50px) rotateY( -90deg); }
        .show-3 { transform: translateZ(-50px) rotateY(-180deg); }
        .show-4 { transform: translateZ(-50px) rotateY(  90deg); }
        .show-5 { transform: translateZ(-50px) rotateX( -90deg); }
        .show-6 { transform: translateZ(-50px) rotateX(  90deg); }

        /* Rolling Animation */
        @keyframes roll {
            0% { transform: translateZ(-50px) rotateX(0deg) rotateY(0deg) rotateZ(0deg); }
            25% { transform: translateZ(-50px) rotateX(180deg) rotateY(90deg) rotateZ(45deg); }
            50% { transform: translateZ(-50px) rotateX(360deg) rotateY(180deg) rotateZ(90deg); }
            75% { transform: translateZ(-50px) rotateX(540deg) rotateY(270deg) rotateZ(135deg); }
            100% { transform: translateZ(-50px) rotateX(720deg) rotateY(360deg) rotateZ(180deg); }
        }
        .rolling {
            animation: roll 0.5s infinite linear;
        }

        /* Dot styles for dice */
        .dot { width: 18px; height: 18px; background: #334155; border-radius: 50%; display: block; position: absolute; }
        /* Face 1 */
        .face-1 .dot:nth-child(1) { top: 41px; left: 41px; background: #ef4444; width: 24px; height: 24px; }
        /* Face 2 */
        .face-2 .dot:nth-child(1) { top: 20px; left: 20px; }
        .face-2 .dot:nth-child(2) { bottom: 20px; right: 20px; }
        /* Face 3 */
        .face-3 .dot:nth-child(1) { top: 20px; left: 20px; }
        .face-3 .dot:nth-child(2) { top: 41px; left: 41px; }
        .face-3 .dot:nth-child(3) { bottom: 20px; right: 20px; }
        /* Face 4 */
        .face-4 .dot:nth-child(1) { top: 20px; left: 20px; }
        .face-4 .dot:nth-child(2) { top: 20px; right: 20px; }
        .face-4 .dot:nth-child(3) { bottom: 20px; left: 20px; }
        .face-4 .dot:nth-child(4) { bottom: 20px; right: 20px; }
        /* Face 5 */
        .face-5 .dot:nth-child(1) { top: 20px; left: 20px; }
        .face-5 .dot:nth-child(2) { top: 20px; right: 20px; }
        .face-5 .dot:nth-child(3) { top: 41px; left: 41px; }
        .face-5 .dot:nth-child(4) { bottom: 20px; left: 20px; }
        .face-5 .dot:nth-child(5) { bottom: 20px; right: 20px; }
        /* Face 6 */
        .face-6 .dot:nth-child(1) { top: 20px; left: 20px; }
        .face-6 .dot:nth-child(2) { top: 20px; right: 20px; }
        .face-6 .dot:nth-child(3) { top: 41px; left: 20px; }
        .face-6 .dot:nth-child(4) { top: 41px; right: 20px; }
        .face-6 .dot:nth-child(5) { bottom: 20px; left: 20px; }
        .face-6 .dot:nth-child(6) { bottom: 20px; right: 20px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS ---
        const IconArrowLeft = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>;
        const IconHeart = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>;
        const IconTrophy = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>;
        const IconX = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>;

        // --- DATA ---
        const GAME_MODES = [
            { id: 'normal', title: '普通版', description: '适合朋友和初次游戏', icon: '??', color: 'text-yellow-400', gradient: 'from-yellow-400/20 to-yellow-600/20' },
            { id: 'love', title: '恋爱版', description: '适合恋爱中的情侣', icon: '??', color: 'text-pink-400', gradient: 'from-pink-400/20 to-pink-600/20' },
            { id: 'couple', title: '情侣版', description: '适合稳定关系的情侣', icon: '??', color: 'text-rose-500', gradient: 'from-rose-500/20 to-rose-700/20' },
            { id: 'deep', title: '深入版', description: '适合想要更多刺激的情侣', icon: '??', color: 'text-red-600', gradient: 'from-red-600/20 to-red-800/20' },
            { id: 'private', title: '私密版', description: '仅限私密空间', icon: '??', color: 'text-purple-600', gradient: 'from-purple-600/20 to-purple-800/20' },
            { id: 'mix', title: '组合版', description: '随机组合各种模式', icon: '??', color: 'text-indigo-500', gradient: 'from-indigo-500/20 to-indigo-700/20' },
        ];

        const TASKS = {
            normal: [
                { id: 'n1', content: '互相说出对方的一个优点', type: 'action' },
                { id: 'n2', content: '给对方讲一个笑话', type: 'action' },
                { id: 'n3', content: '深情对视10秒', type: 'action' },
                { id: 'n4', content: '拥抱对方一下', type: 'action' },
                { id: 'n5', content: '为对方唱一首歌的副歌部分', type: 'action' },
                { id: 'n6', content: '说出第一次见面的印象', type: 'truth' },
                { id: 'n7', content: '模仿对方的一个习惯动作', type: 'action' },
                { id: 'n8', content: '给对方起一个可爱的昵称', type: 'action' },
                { id: 'n9', content: '分享一件小时候的趣事', type: 'truth' },
                { id: 'n10', content: '做5个深蹲', type: 'action' },
            ],
            love: [
                { id: 'l1', content: '亲吻对方的脸颊', type: 'action' },
                { id: 'l2', content: '说出对方最吸引你的三个地方', type: 'truth' },
                { id: 'l3', content: '公主抱/背对方一分钟', type: 'action' },
                { id: 'l4', content: '用嘴喂对方吃一样东西', type: 'action' },
                { id: 'l5', content: '向对方表白', type: 'action' },
                { id: 'l6', content: '描述一下你心中完美的约会', type: 'truth' },
                { id: 'l7', content: '亲吻对方的手背', type: 'action' },
                { id: 'l8', content: '让对方坐在你的腿上1分钟', type: 'action' },
                { id: 'l9', content: '给对方按摩肩膀3分钟', type: 'action' },
                { id: 'l10', content: '说出你最喜欢对方身体的哪个部位', type: 'truth' },
            ],
            couple: [
                { id: 'c1', content: '亲吻对方的嘴唇10秒', type: 'action' },
                { id: 'c2', content: '在对方耳边轻轻说"我爱你"', type: 'action' },
                { id: 'c3', content: '种草莓（吻痕）一个', type: 'action' },
                { id: 'c4', content: '脱掉对方一件衣服（外套除外）', type: 'action' },
                { id: 'c5', content: '用舌头舔对方的耳垂', type: 'action' },
                { id: 'c6', content: '说出你对对方的一个性幻想', type: 'truth' },
                { id: 'c7', content: '让对方检查你的内衣颜色', type: 'action' },
                { id: 'c8', content: '亲吻对方的脖子', type: 'action' },
                { id: 'c9', content: '用身体的一个部位触碰对方的敏感部位', type: 'action' },
                { id: 'c10', content: '发出诱惑的声音', type: 'action' },
            ],
            deep: [
                { id: 'd1', content: '法式热吻30秒', type: 'action' },
                { id: 'd2', content: '脱掉一件衣服', type: 'action' },
                { id: 'd3', content: '抚摸对方的敏感部位1分钟', type: 'action' },
                { id: 'd4', content: '用嘴解开对方的一颗扣子', type: 'action' },
                { id: 'd5', content: '模仿一种性爱姿势', type: 'action' },
                { id: 'd6', content: '说出你最想尝试的地点', type: 'truth' },
                { id: 'd7', content: '让对方蒙眼，你用身体触碰他/她', type: 'action' },
                { id: 'd8', content: '互相脱掉对方的一件衣物', type: 'action' },
                { id: 'd9', content: '亲吻对方的大腿内侧', type: 'action' },
                { id: 'd10', content: '用嘴含住对方的手指', type: 'action' },
            ],
            private: [
                { id: 'p1', content: '（私密内容，请自行想象或添加）', type: 'action' },
                { id: 'p2', content: '（私密内容，请自行想象或添加）', type: 'action' },
            ],
            mix: [],
        };

        // --- COMPONENTS ---

        const Dice = ({ value, isRolling, onClick, disabled }) => {
            const diceClass = isRolling ? 'rolling' : (value ? `show-${value}` : 'show-1');
            
            return (
                <div className="scene cursor-pointer" onClick={!disabled ? onClick : undefined}>
                    <div className={`cube ${diceClass}`}>
                        <div className="cube__face cube__face--1 face-1"><span className="dot"></span></div>
                        <div className="cube__face cube__face--2 face-2"><span className="dot"></span><span className="dot"></span></div>
                        <div className="cube__face cube__face--3 face-3"><span className="dot"></span><span className="dot"></span><span className="dot"></span></div>
                        <div className="cube__face cube__face--4 face-4"><span className="dot"></span><span className="dot"></span><span className="dot"></span><span className="dot"></span></div>
                        <div className="cube__face cube__face--5 face-5"><span className="dot"></span><span className="dot"></span><span className="dot"></span><span className="dot"></span><span className="dot"></span></div>
                        <div className="cube__face cube__face--6 face-6"><span className="dot"></span><span className="dot"></span><span className="dot"></span><span className="dot"></span><span className="dot"></span><span className="dot"></span></div>
                    </div>
                </div>
            );
        };

        const PlayerToken = ({ player, isCurrent }) => (
            <div className={`relative flex items-center justify-center transition-all duration-300 ${isCurrent ? 'scale-125 z-10' : 'scale-100 z-0'}`}>
                <div className={`w-8 h-8 rounded-full flex items-center justify-center text-lg shadow-md border-2 border-white ${player.color}`}>
                    {player.avatar}
                </div>
                {isCurrent && (
                    <div className="absolute -bottom-1 w-2 h-2 bg-white rounded-full animate-bounce" />
                )}
            </div>
        );

        const TaskModal = ({ task, onClose }) => {
            if (!task) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200">
                    <div className="bg-white rounded-3xl p-8 max-w-sm w-full shadow-2xl transform transition-all scale-100 relative overflow-hidden">
                        <div className={`absolute top-0 left-0 w-full h-2 ${task.type === 'truth' ? 'bg-blue-500' : 'bg-pink-500'}`} />
                        <button onClick={onClose} className="absolute top-4 right-4 p-2 rounded-full hover:bg-gray-100 transition-colors text-gray-500">
                            <IconX />
                        </button>
                        <div className="flex flex-col items-center text-center gap-6 mt-2">
                            <div className={`w-16 h-16 rounded-2xl flex items-center justify-center ${task.type === 'truth' ? 'bg-blue-100 text-blue-600' : 'bg-pink-100 text-pink-600'}`}>
                                {task.type === 'truth' ? <span className="text-3xl">?</span> : <span className="text-3xl">!</span>}
                            </div>
                            <div>
                                <h3 className={`text-sm font-bold uppercase tracking-wider mb-2 ${task.type === 'truth' ? 'text-blue-500' : 'text-pink-500'}`}>
                                    {task.type === 'truth' ? '真心话 (Truth)' : '大冒险 (Dare)'}
                                </h3>
                                <p className="text-xl font-medium text-slate-800 leading-relaxed">
                                    {task.content}
                                </p>
                            </div>
                            <button onClick={onClose} className={`w-full py-3 px-6 rounded-xl font-bold text-white shadow-lg transition-transform active:scale-95 ${task.type === 'truth' ? 'bg-blue-500 hover:bg-blue-600 shadow-blue-500/30' : 'bg-pink-500 hover:bg-pink-600 shadow-pink-500/30'}`}>
                                完成任务
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---

        const App = () => {
            const [currentMode, setCurrentMode] = useState(null);
            const [players, setPlayers] = useState({
                p1: { id: 'p1', name: '男生', avatar: '??', position: 0, color: 'bg-blue-500' },
                p2: { id: 'p2', name: '女生', avatar: '??', position: 0, color: 'bg-pink-500' },
            });
            const [currentPlayerId, setCurrentPlayerId] = useState('p1');
            const [diceValue, setDiceValue] = useState(1);
            const [isRolling, setIsRolling] = useState(false);
            const [showTaskModal, setShowTaskModal] = useState(false);
            const [currentTask, setCurrentTask] = useState(null);

            const BOARD_SIZE = 20;
            const TILES = Array.from({ length: BOARD_SIZE }, (_, i) => ({
                id: i,
                type: i === 0 ? 'start' : i === BOARD_SIZE - 1 ? 'end' : 'normal',
            }));

            const resetGame = () => {
                setCurrentMode(null);
                setPlayers({
                    p1: { ...players.p1, position: 0 },
                    p2: { ...players.p2, position: 0 },
                });
                setCurrentPlayerId('p1');
                setDiceValue(1);
                setIsRolling(false);
                setShowTaskModal(false);
                setCurrentTask(null);
            };

            const rollDice = () => {
                if (isRolling) return;
                setIsRolling(true);
                
                // Simulate rolling
                setTimeout(() => {
                    const value = Math.floor(Math.random() * 6) + 1;
                    setDiceValue(value);
                    setIsRolling(false);
                    movePlayer(currentPlayerId, value);
                }, 1000);
            };

            const movePlayer = (pid, steps) => {
                setPlayers(prev => {
                    const p = prev[pid];
                    let newPos = p.position + steps;
                    if (newPos >= BOARD_SIZE - 1) newPos = BOARD_SIZE - 1; // Cap at end
                    return { ...prev, [pid]: { ...p, position: newPos } };
                });
            };

            // Effect to trigger task after move
            useEffect(() => {
                if (!isRolling && currentMode) {
                    const p = players[currentPlayerId];
                    // Trigger task if moved and not at start/end
                    // Note: In a real game, we'd check if position actually changed. 
                    // Here we assume movePlayer is called right after roll.
                    // To be safe, we can check if we are on a special tile or just random.
                    if (p.position > 0 && p.position < BOARD_SIZE - 1) {
                        // Small delay for visual movement
                        const timer = setTimeout(() => {
                            const modeTasks = TASKS[currentMode] || TASKS['normal'];
                            if (modeTasks.length > 0) {
                                const randomTask = modeTasks[Math.floor(Math.random() * modeTasks.length)];
                                setCurrentTask(randomTask);
                                setShowTaskModal(true);
                            }
                        }, 600);
                        return () => clearTimeout(timer);
                    }
                }
            }, [players, isRolling, currentMode, currentPlayerId]);

            const completeTask = () => {
                setShowTaskModal(false);
                setCurrentTask(null);
                // Next turn
                setCurrentPlayerId(prev => prev === 'p1' ? 'p2' : 'p1');
            };

            // --- RENDER ---

            if (!currentMode) {
                return (
                    <div className="min-h-screen bg-slate-900 text-white p-6 flex flex-col items-center justify-center">
                        <div className="text-center mb-10">
                            <h1 className="text-4xl font-bold bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 bg-clip-text text-transparent mb-4">
                                情侣飞行棋
                            </h1>
                            <p className="text-slate-400">选择一个模式开始游戏</p>
                        </div>
                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-2xl">
                            {GAME_MODES.map(mode => (
                                <button
                                    key={mode.id}
                                    onClick={() => setCurrentMode(mode.id)}
                                    className={`relative group overflow-hidden rounded-2xl p-6 text-left transition-all duration-300 hover:scale-105 border border-white/5 bg-gradient-to-br ${mode.gradient}`}
                                >
                                    <div className="relative z-10 flex items-start justify-between">
                                        <div>
                                            <div className="text-3xl mb-3">{mode.icon}</div>
                                            <h3 className={`text-xl font-bold mb-1 ${mode.color}`}>{mode.title}</h3>
                                            <p className="text-sm text-gray-300/80">{mode.description}</p>
                                        </div>
                                    </div>
                                </button>
                            ))}
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-slate-900 text-white flex flex-col relative overflow-hidden">
                    {/* Header */}
                    <div className="p-4 flex items-center justify-between bg-slate-800/50 backdrop-blur-md z-10">
                        <button onClick={resetGame} className="p-2 rounded-full hover:bg-white/10 transition-colors">
                            <IconArrowLeft />
                        </button>
                        <h2 className="text-lg font-bold bg-gradient-to-r from-pink-400 to-violet-400 bg-clip-text text-transparent">
                            {GAME_MODES.find(m => m.id === currentMode)?.title}
                        </h2>
                        <div className="w-10" />
                    </div>

                    {/* Board */}
                    <div className="flex-1 relative overflow-y-auto p-8 flex justify-center items-center">
                        <div className="relative w-full max-w-md aspect-[3/4] bg-slate-800/30 rounded-3xl border border-white/5 p-6 grid grid-cols-4 gap-4 content-start">
                            {TILES.map((tile) => (
                                <div key={tile.id} className={`aspect-square rounded-xl flex items-center justify-center text-sm font-bold relative ${
                                    tile.type === 'start' ? 'bg-green-500/20 text-green-400 border border-green-500/30' : 
                                    tile.type === 'end' ? 'bg-red-500/20 text-red-400 border border-red-500/30' : 
                                    'bg-white/5 text-gray-400 border border-white/5'
                                }`}>
                                    {tile.type === 'start' ? 'START' : tile.type === 'end' ? 'FINISH' : tile.id}
                                    <div className="absolute inset-0 flex items-center justify-center gap-1 pointer-events-none">
                                        {Object.values(players).map(p => (
                                            p.position === tile.id && (
                                                <PlayerToken key={p.id} player={p} isCurrent={currentPlayerId === p.id} />
                                            )
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Controls */}
                    <div className="p-6 bg-slate-800/80 backdrop-blur-xl border-t border-white/10 z-20 pb-10">
                        <div className="max-w-md mx-auto flex flex-col items-center gap-6">
                            <div className="flex items-center gap-4 w-full justify-between px-4">
                                {/* Player 1 Info */}
                                <div className={`flex flex-col items-center transition-opacity duration-300 ${currentPlayerId === 'p1' ? 'opacity-100 scale-110' : 'opacity-50 scale-90'}`}>
                                    <div className={`w-12 h-12 rounded-full flex items-center justify-center text-2xl bg-blue-500 shadow-lg shadow-blue-500/30 border-2 ${currentPlayerId === 'p1' ? 'border-white' : 'border-transparent'}`}>
                                        {players.p1.avatar}
                                    </div>
                                    <span className="text-xs mt-2 font-medium text-blue-300">{players.p1.name}</span>
                                </div>

                                {/* Turn Info */}
                                <div className="text-center">
                                    <div className="text-xs text-gray-400 mb-1 uppercase tracking-wider">当前回合</div>
                                    <div className="text-xl font-bold text-white">{players[currentPlayerId].name}</div>
                                </div>

                                {/* Player 2 Info */}
                                <div className={`flex flex-col items-center transition-opacity duration-300 ${currentPlayerId === 'p2' ? 'opacity-100 scale-110' : 'opacity-50 scale-90'}`}>
                                    <div className={`w-12 h-12 rounded-full flex items-center justify-center text-2xl bg-pink-500 shadow-lg shadow-pink-500/30 border-2 ${currentPlayerId === 'p2' ? 'border-white' : 'border-transparent'}`}>
                                        {players.p2.avatar}
                                    </div>
                                    <span className="text-xs mt-2 font-medium text-pink-300">{players.p2.name}</span>
                                </div>
                            </div>

                            <Dice 
                                value={diceValue} 
                                isRolling={isRolling} 
                                onClick={rollDice} 
                                disabled={isRolling || showTaskModal}
                            />
                            
                            <p className="text-sm text-gray-400 animate-pulse">
                                {isRolling ? '骰子滚动中...' : '点击骰子掷点'}
                            </p>
                        </div>
                    </div>

                    {showTaskModal && (
                        <TaskModal task={currentTask} onClose={completeTask} />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>